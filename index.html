<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetDesk - Get the Facts Fast</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Landing Page Styles */
        .landing-section {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 60px 20px;
        }
        
        .brand {
            font-size: 14px;
            font-weight: 500;
            color: #999;
            letter-spacing: 2px;
            margin-bottom: 40px;
        }
        
        .headline {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 400;
            color: #333;
            margin-bottom: 60px;
            line-height: 1.1;
            max-width: 900px;
        }
        
        .description {
            font-size: 18px;
            color: #666;
            max-width: 800px;
            margin: 0 auto 40px;
            line-height: 1.7;
        }
        
        .tagline {
            font-size: 18px;
            color: #666;
            max-width: 700px;
            margin: 0 auto 60px;
            line-height: 1.7;
        }
        
        .cta-button {
            display: inline-block;
            background: #2563eb;
            color: white;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 500;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.3s ease;
            cursor: pointer;
            border: none;
        }
        
        .cta-button:hover {
            background: #1d4ed8;
        }

        /* Chatbot Section Styles */
        .chatbot-section {
            min-height: 100vh;
        }
        
        .two-column-layout {
            display: flex !important;
            height: 100vh !important;
            width: 100% !important;
            flex-direction: row !important;
        }
        
        .chat-column {
            flex: 1 !important;
            min-width: 0 !important;
            width: auto !important;
        }
        
        .news-column {
            width: 400px !important;
            min-width: 400px !important;
            max-width: 400px !important;
            flex-shrink: 0 !important;
            border-left: 1px solid #e5e7eb !important;
            background: white !important;
        }
        
        @media (max-width: 768px) {
            .landing-section {
                padding: 40px 20px;
            }
            
            .description, .tagline {
                font-size: 16px;
            }
            
            .cta-button {
                padding: 14px 28px;
                font-size: 15px;
            }
            
            .two-column-layout {
                flex-direction: column;
            }
            
            .news-column {
                width: 100%;
                height: 300px;
                border-left: none;
                border-top: 1px solid #e5e7eb;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Section -->
    <section class="landing-section">
        <div class="brand">VETDESK™</div>
        
        <h1 class="headline">Get the Facts Fast.</h1>
        
        <p class="description">
            Every veteran has questions. Few get answers that make sense. VetDesk breaks down policies, benefits, and news in real time—so you see what's happening, what's changing, and what it means for you.
        </p>
        
        <p class="tagline">
            It's not just information. It's context. It's clarity. It's control. Built for veterans who need answers - now.
        </p>
        
        <button class="cta-button" onclick="scrollToChatbot()">Try Demo - It's Free</button>
    </section>

    <!-- Chatbot Section -->
    <section class="chatbot-section">
        <div id="chatbot-root"></div>
    </section>

    <script>
        function scrollToChatbot() {
            document.querySelector('.chatbot-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
    </script>

    <!-- Your existing chatbot code goes here -->
    <script type="text/babel">
(function() {
const { useState, useEffect, useRef } = React;

const renderMarkdown = (text) => {
return text
.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
.replace(/\*(.*?)\*/g, '<em>$1</em>')
.replace(/`(.*?)`/g, '<code>$1</code>')
.replace(/### (.*$)/gm, '<h3>$1</h3>')
.replace(/## (.*$)/gm, '<h2>$1</h2>')
.replace(/# (.*$)/gm, '<h1>$1</h1>')
.replace(/https?:\/\/[^\s<>"]+/g, '<a href="$&" target="_blank" class="text-blue-600 hover:text-blue-800 underline">$&</a>')
.replace(/\n\n/g, '</p><p>')
.replace(/\n/g, '<br>')
.replace(/^/, '<p>')
.replace(/$/, '</p>')
.replace(/<p><\/p>/g, '')
.replace(/\(\[Source\]\((https?:\/\/[^)]+)\)\)/g, '<br><a href="$1" target="_blank" class="text-blue-600 hover:text-blue-800 underline text-sm">Read full article →</a>')
.replace(/\[Read full article →\]\((https?:\/\/[^)]+)\)/g, '<a href="$1" target="_blank" class="text-blue-600 hover:text-blue-800 underline text-sm">Read full article →</a>');
};

function ChatbotApp() {
const [messages, setMessages] = useState([]);
const [input, setInput] = useState('');
const [isLoading, setIsLoading] = useState(false);
const [lastMessageTime, setLastMessageTime] = useState(0);
const [newsArticles, setNewsArticles] = useState([]);
const [loadingNews, setLoadingNews] = useState(true);
const [emailState, setEmailState] = useState({
waitingForEmail: false,
lastBotResponse: null,
lastUserQuestion: null
});
const messagesEndRef = useRef(null);
const textareaRef = useRef(null);

const MAX_MESSAGE_LENGTH = 2000;

useEffect(() => {
const loadNews = async () => {
try {
const newsRes = await fetch("https://vetdesk-demo2-api.vercel.app/api/va-news");
if (newsRes.ok) {
const newsData = await newsRes.json();
setNewsArticles(newsData.sources || []);
}
} catch (error) {
console.log("Failed to load news:", error);
} finally {
setLoadingNews(false);
}
};
loadNews();
}, []);

useEffect(() => {
const textarea = textareaRef.current;
if (textarea) {
textarea.style.height = 'auto';
textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
}
}, [input]);

useEffect(() => {
if (messages.length > 1) {
requestAnimationFrame(() => {
messagesEndRef.current?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
});
}
}, [messages]);

const extractTopicFromQuestion = (question) => {
const lowerQuestion = question.toLowerCase();
if (lowerQuestion.includes('claim')) return 'VA Claims Process';
if (lowerQuestion.includes('appeal')) return 'VA Appeals Process';
if (lowerQuestion.includes('disability')) return 'Disability Benefits';
return 'VA Benefits Information';
};

const shouldOfferEmail = (botResponse) => {
return botResponse.length > 200 && (
botResponse.includes('step') ||
botResponse.includes('process') ||
botResponse.includes('claim')
);
};

const handleNewsQuestion = (article) => {
const question = `How does this news affect my benefits: "${article.title}"`;
setMessages(prev => [...prev, { text: question, sender: 'user' }]);
setLastMessageTime(0);
const articleContext = `Article: "${article.title}" - ${article.source} - ${new Date(article.pubDate).toLocaleDateString()}`;
setTimeout(() => sendMessageToGemini(question, articleContext), 100);
};

const sendMessageToGemini = async (userMessage, articleContext = "") => {
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (emailState.waitingForEmail && emailRegex.test(userMessage.trim())) {
setIsLoading(true);
try {
const response = await fetch('https://vetdesk-demo2-api.vercel.app/api/send-summary', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({
email: userMessage.trim(),
subject: extractTopicFromQuestion(emailState.lastUserQuestion),
content: emailState.lastBotResponse,
userName: 'Veteran'
})
});
const result = await response.json();
if (result.success) {
setMessages(prev => [...prev, { text: `✅ ${result.message}`, sender: 'model' }]);
} else {
setMessages(prev => [...prev, { text: "Sorry, couldn't send email. Please try again.", sender: 'model' }]);
}
} catch (error) {
setMessages(prev => [...prev, { text: "Sorry, couldn't send email. Please try again.", sender: 'model' }]);
}
setEmailState({ waitingForEmail: false, lastBotResponse: null, lastUserQuestion: null });
setIsLoading(false);
return;
}

const now = Date.now();
const timeSinceLastMessage = now - lastMessageTime;
if (timeSinceLastMessage < 5000) return;
setLastMessageTime(now);
setIsLoading(true);
try {
let faqJson = {};
try {
const faqContextRes = await fetch("https://jsonblob.com/api/jsonBlob/1393450047760424960");
faqJson = await faqContextRes.json();
} catch (faqError) {
console.log("FAQ fetch failed, continuing with empty context");
}

let newsContext = "";
if (userMessage.toLowerCase().includes("news") || userMessage.toLowerCase().includes("recent va")) {
try {
const newsRes = await fetch("https://vetdesk-demo2-api.vercel.app/api/va-news");
if (newsRes.ok) {
const newsData = await newsRes.json();
newsContext = newsData.summary || "";
}
} catch (newsError) {
console.log("News fetch failed");
}
}

if (!faqJson.system_resources) faqJson.system_resources = {};

const systemPrompt = `You are a knowledgeable VA benefits specialist who communicates like a helpful, candid, and empathetic friend. Your job is to translate complex VA news and policy into plain English, giving veterans a realistic and compassionate understanding of how changes may impact them. Answers should be on a 10th grade level.

When asked about news or policy changes:
Always acknowledge the user's concerns or feelings before providing information.
Thank veterans sincerely when they identify themselves, and express appreciation for their service.
Analyze both the positive and negative potential impacts for veterans, referencing real-world outcomes or VA history when relevant—even if the news is not reassuring.
If there are risks (such as delays, backlogs, or reduced access), explain them clearly and empathetically.
Identify which groups of veterans are most likely to be affected e.g., rural, disabled, those with complex claims.
Offer actionable, practical advice, such as monitoring claims, keeping documentation, or contacting the VA if delays occur.
Do not simply repeat official statements; provide a frank, evidence-based critique and question optimistic claims when appropriate, while maintaining a courteous and supportive tone.
Use warm, supportive, and patient language. Avoid abrupt or dismissive transitions like "Now," or "Anyway". After thanking a veteran, use gentle invitations such as "How can I assist you further with..." or "Please let me know if you have more questions about...".
Keep answers conversational but informative (2–4 sentences). Use **bold** for important numbers or deadlines.
End responses naturally. Don't always ask 'What else can I help you with?' For follow-up questions, just end normally or ask 'Make sense?' For news articles, you can ask 'Want me to check another article?' Keep it conversational, not robotic.

Your responses should always be attentive, respectful, and honest—even if the truth is uncomfortable. Veterans rely on you for clarity, empathy, and actionable support—not just reassurance. Don't say 'thank you for your service' unless someone specifically mentions they're a veteran. Focus on answering their question.
`;

let chatHistoryForAPI = [
{
role: "user",
parts: [{ text: systemPrompt + (newsContext ? " Current VA News: " + newsContext : "") + (articleContext ? " Article Context: " + articleContext : "") }]
},
{
role: "user",
parts: [{ text: JSON.stringify(faqJson) }]
}
];

messages.forEach(msg => {
chatHistoryForAPI.push({
role: msg.sender === 'user' ? 'user' : 'model',
parts: [{ text: msg.text }]
});
});

chatHistoryForAPI.push({
role: "user",
parts: [{ text: userMessage }]
});

const response = await fetch("https://vetdesk-demo2-api.vercel.app/api/chat", {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({ chatHistory: chatHistoryForAPI })
});

const result = await response.json();
const botText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't get a response.";

let finalBotText = botText;
if (shouldOfferEmail(botText) && !emailState.waitingForEmail) {
finalBotText += "\n\nWould you like me to send this to your email for future reference?";
setEmailState({
waitingForEmail: true,
lastBotResponse: botText,
lastUserQuestion: userMessage
});
}

setMessages(prev => [...prev, { text: finalBotText, sender: 'model' }]);
} catch (e) {
setMessages(prev => [...prev, {
text: "I'm experiencing technical difficulties. Try later or call VA at 1-800-827-1000.",
sender: 'model'
}]);
} finally {
setIsLoading(false);
}
};

const handleSendMessage = (overrideMessage) => {
const userMessage = (overrideMessage !== undefined ? overrideMessage : input).trim();
if (!userMessage || isLoading) return;

if (userMessage.toLowerCase().includes('yes') && emailState.lastBotResponse) {
setEmailState(prev => ({ ...prev, waitingForEmail: true }));
setMessages(prev => [...prev, 
{ text: userMessage, sender: 'user' },
{ text: "What's your email address?", sender: 'model' }
]);
setInput('');
return;
}

if (userMessage.toLowerCase().includes('no') && emailState.lastBotResponse) {
setEmailState({ waitingForEmail: false, lastBotResponse: null, lastUserQuestion: null });
setMessages(prev => [...prev, 
{ text: userMessage, sender: 'user' },
{ text: "No problem! What else can I help you with?", sender: 'model' }
]);
setInput('');
return;
}

setMessages(prev => [...prev, { text: userMessage, sender: 'user' }]);
setInput('');
sendMessageToGemini(userMessage);
setTimeout(() => textareaRef.current?.focus(), 100);
};

const handleKeyPress = (e) => {
if (e.key === 'Enter' && !e.shiftKey) {
e.preventDefault();
handleSendMessage();
}
};

const handleInputChange = (e) => {
const newValue = e.target.value;
if (newValue.length <= MAX_MESSAGE_LENGTH) {
setInput(newValue);
}
};

const quickActions = [
{
text: "How does the VA calculate disability ratings, and what counts as service-connected? How does the combined rating formula work?",
label: "Disability Ratings"
},
{
text: "What are my options for appealing a VA decision? What are the different appeal lanes and their deadlines?",
label: "Appeals Process"
},
{
text: "How do VA healthcare priority groups work, and how do I access care? When can I use non-VA providers?",
label: "Healthcare Enrollment"
},
{
text: "What are the eligibility requirements for VA benefits, and how do I know which programs or family benefits I qualify for?",
label: "Eligibility"
},
{
text: "Which forms do I need to file for my situation, and how do I use VA.gov or My HealtheVet to track my claim or upload documents?",
label: "Forms & Online Tools"
}
];

const renderMessage = (msg, index) => {
const isUser = msg.sender === 'user';
const messageClasses = `p-4 rounded-2xl max-w-full text-base leading-relaxed markdown-content ${isUser ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-900'}`;

return (
<div key={index} className={`flex ${isUser ? 'justify-end' : 'justify-start'} px-4 py-2`}>
<div className={`flex flex-col ${isUser ? 'items-end' : 'items-start'} max-w-full`}>
<div className={messageClasses}>
<div dangerouslySetInnerHTML={{ __html: renderMarkdown(msg.text) }} />
</div>
</div>
</div>
);
};

return (
<>
<div className="two-column-layout h-full">
<div className="chat-column flex flex-col bg-gray-50">
<div className="flex-1 overflow-y-auto px-3 py-4 space-y-4">
{messages.length === 0 && !isLoading ? (
<div className="flex flex-col items-center justify-center h-full text-center p-6">
<div className="mb-6">
<h2 className="text-2xl font-bold text-gray-800 mb-3">Welcome to VetDesk</h2>
<p className="text-lg text-gray-600 leading-relaxed mb-4">Get answers about your benefits or how current events will affect them.</p>
<p className="text-sm text-gray-500 mb-4 italic">Note: For your privacy, we don't store conversations. Refreshing or leaving this page will reset your session.</p>
</div>
<div className="flex flex-wrap justify-center gap-2">
{quickActions.map((action, idx) => (
<button
key={idx}
onClick={() => {
if (isLoading) return;
setMessages(prev => [...prev, { text: action.text, sender: 'user' }]);
setLastMessageTime(0);
setTimeout(() => sendMessageToGemini(action.text), 100);
}}
disabled={isLoading}
className="px-3 py-2 rounded-lg text-sm transition-colors bg-blue-100 text-blue-700 hover:bg-blue-200 disabled:opacity-50"
>
{action.label}
</button>
))}
</div>
</div>
) : (
messages.map(renderMessage)
)}

{isLoading && (
<div className="flex justify-start px-4 py-2">
<div className="p-4 rounded-2xl bg-gray-200 text-gray-900 max-w-full">
<div className="flex items-center space-x-3">
<div className="flex space-x-1">
<div className="w-2.5 h-2.5 bg-blue-500 rounded-full animate-pulse"></div>
<div className="w-2.5 h-2.5 bg-blue-500 rounded-full animate-pulse" style={{animationDelay: '0.2s'}}></div>
<div className="w-2.5 h-2.5 bg-blue-500 rounded-full animate-pulse" style={{animationDelay: '0.4s'}}></div>
</div>
<span className="text-sm text-gray-600 font-medium">Thinking...</span>
</div>
</div>
</div>
)}
<div ref={messagesEndRef}></div>
</div>

<div className="border-t border-gray-300 bg-gray-50 p-4">
<div className="flex space-x-3">
<textarea
ref={textareaRef}
className="flex-1 p-4 bg-white text-gray-900 rounded-2xl border-2 border-gray-400 focus:outline-none text-base resize-none"
value={input}
onChange={handleInputChange}
onKeyDown={handleKeyPress}
disabled={isLoading}
style={{ minHeight: '52px', maxHeight: '120px', overflow: 'hidden' }}
/>
<button
className="px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-medium text-base chatbot-send-button"
onClick={handleSendMessage}
disabled={!input.trim() || isLoading}
>
↑
</button>
</div>
</div>
</div>

<div className="news-column flex flex-col">
<div className="p-4 border-b border-gray-200">
<h3 className="font-bold text-gray-800">Recent Veterans News</h3>
</div>
<div className="flex-1 overflow-y-auto p-4">
{loadingNews ? (
<div className="text-center text-gray-500">Loading news...</div>
) : newsArticles.length > 0 ? (
<div className="space-y-3">
{newsArticles.map((article, index) => (
<div key={index} className="border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
{article.image && (
<img
src={article.image}
alt={article.title}
className="w-full h-32 object-cover rounded-lg mb-3"
onError={(e) => e.target.style.display = 'none'}
/>
)}
<h4 className="font-semibold text-base mb-3 text-gray-800 leading-snug">
<a href={article.link} target="_blank" rel="noopener noreferrer" className="hover:text-blue-600 transition-colors">
{article.title}
</a>
</h4>
<div className="flex flex-col space-y-3">
<span className="text-sm text-gray-500">{new Date(article.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - {article.source}</span>
<button
onClick={() => handleNewsQuestion(article)}
className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors"
disabled={isLoading}
>
How does this affect me?
</button>
</div>
</div>
))}
</div>
) : (
<div className="text-center text-gray-500">No news available</div>
)}
</div>
</div>
</div>
</>
);
}

const chatRoot = document.getElementById('chatbot-root');
if (chatRoot) {
try {
if (!chatRoot.hasChildNodes()) {
ReactDOM.createRoot(chatRoot).render(<ChatbotApp />);
}
} catch (error) {
console.error('Failed to render chatbot:', error);
chatRoot.innerHTML = '<div style="padding: 20px; text-align: center;">Chatbot temporarily unavailable. Please refresh the page.</div>';
}
}
})();
</script>
</body>
</html>