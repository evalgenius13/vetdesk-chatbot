<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VetDesk Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' https://vetdesk-demo2-api.vercel.app; font-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .chat-bubble-user {
      max-width: 42rem;
      background: #1e40af;
      color: white;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      line-height: 1.6;
      white-space: pre-line;
      margin-left: auto;
      word-break: break-word;
    }
    .chat-bubble-bot {
      max-width: 42rem;
      background: #f9fafb;
      color: #1f2937;
      border-radius: 1rem;
      padding: 1.5rem;
      line-height: 1.6;
      white-space: pre-line;
      word-break: break-word;
      border: 1px solid #e5e7eb;
    }
    .chat-bubble-bot p {
      margin-bottom: 1rem;
    }
    .chat-bubble-bot p:last-child {
      margin-bottom: 0;
    }

    /* Remove all the animation keyframes */

    .spinner {
      border: 3px solid #e5e7eb;
      border-top: 3px solid #1e40af;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    /* NEW: Enhanced typing indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .typing-dots {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-left: 8px;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #6b7280;
      animation: typingBounce 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    .typing-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes typingBounce {
      0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }

    .message-container {
      margin-bottom: 1.5rem;
    }

    /* Enhanced error styling */
    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }

    .news-loading {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      text-align: center;
      color: #6b7280;
    }
    .news-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
    }

    /* NEW: Auto-resizing textarea styles */
    .chat-textarea {
      resize: none;
      overflow: hidden;
      min-height: 44px;
      max-height: 120px;
    }

    /* NEW: Character counter styles */
    .char-counter {
      font-size: 0.75rem;
      color: #6b7280;
    }

    .char-counter.warning {
      color: #f59e0b;
    }

    .char-counter.danger {
      color: #dc2626;
    }

    /* NEW: Scroll to bottom button */
    .scroll-to-bottom {
      position: fixed;
      bottom: 120px;
      right: 20px;
      z-index: 30;
      background: #1e40af;
      color: white;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(20px) scale(0.8);
      pointer-events: none;
    }

    .scroll-to-bottom.visible {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .scroll-to-bottom:hover {
      background: #1e3a8a;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 16px rgba(30, 64, 175, 0.4);
    }

    .scroll-to-bottom:active {
      transform: translateY(0) scale(0.95);
    }

    /* NEW: Input loading overlay */
    .input-loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(1px);
      z-index: 10;
      border-radius: 0.5rem;
    }

    .input-container {
      position: relative;
    }

    .input-disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    .send-button-loading {
      background: #6b7280 !important;
      cursor: not-allowed !important;
    }

    .send-button-loading:hover {
      background: #6b7280 !important;
    }
    
    @media (max-width: 768px) {
      #news-feed-section {
        display: none;
      }
      #chat-section {
        flex: 1 1 100%;
      }
      
      #quick-actions {
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
        padding: 0.75rem 1rem !important;
      }
      
      #quick-actions::-webkit-scrollbar {
        display: none;
      }
      
      #quick-actions > * {
        display: inline-block;
        white-space: nowrap;
        font-size: 0.75rem !important;
        padding: 0.75rem 1rem !important; /* NEW: Larger padding for better mobile touch */
        margin-right: 0.5rem;
        min-width: auto;
        flex-shrink: 0;
        min-height: 44px; /* NEW: Ensure minimum touch target */
      }
      
      #quick-actions > *:last-child {
        margin-right: 1rem;
      }

      .scroll-to-bottom {
        bottom: 140px;
        right: 16px;
      }

      /* Enhanced mobile textarea */
      .chat-textarea {
        font-size: 16px; /* Prevents zoom on iOS */
        min-height: 44px;
        max-height: 100px; /* Slightly smaller on mobile */
      }
    }
    
    @media (min-width: 769px) {
      #quick-actions {
        flex-wrap: wrap;
        gap: 0.5rem;
        padding: 1rem !important;
      }
      
      #quick-actions > * {
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
      }
    }
  </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">

  <header class="bg-blue-900 text-white p-3 sm:p-4">
    <div class="flex items-center justify-between">
      <!-- Left side - Brand with logo after text -->
      <div class="flex items-center min-w-0 flex-1">
        <h1 class="text-lg sm:text-2xl font-bold mr-0.5">VetDesk</h1>
        <img src="/logo.png" alt="VetDesk Logo" class="w-6 h-6 sm:w-8 sm:h-8 mr-2 flex-shrink-0">
        <span class="text-xs sm:text-sm font-light text-blue-200">VA Benefits, Simplified.</span>
      </div>
      
      <!-- Right side - Navigation -->
      <div class="flex items-center flex-shrink-0 ml-2">
        <!-- Mobile Hamburger Menu -->
        <div class="md:hidden">
          <button id="mobile-menu-button" class="bg-blue-800 hover:bg-blue-700 text-white p-2 rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-3">
          <!-- About Dropdown -->
          <div class="relative">
            <button id="about-button" class="bg-blue-800 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
              <span class="mr-1">ℹ️</span>About
            </button>
            <div id="about-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white text-gray-800 rounded-lg shadow-lg border z-50">
              <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="font-semibold text-lg">About VetDesk</h3>
                  <button id="about-close" class="text-gray-400 hover:text-gray-600 text-2xl w-8 h-8 flex items-center justify-center">&times;</button>
                </div>
                
                <div class="space-y-4 max-h-[60vh] overflow-y-auto">
                  <div>
                    <h4 class="font-medium text-blue-900 mb-2 text-sm">What is VetDesk?</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">VetDesk™ is a free service made by veterans for veterans. Our mission is to help explain VA benefits and the policies that affect them in plain English and in a secure, simple, and respectful way. Just ask questions and get clear answers.</p>
                  </div>
                  
                  <div>
                    <h4 class="font-medium text-blue-900 mb-2 text-sm">Important</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">VetDesk™ is independent and not affiliated with the VA. For the latest information or to apply for benefits, visit VA.gov or call 1-800-827-1000.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- FAQ Dropdown -->
          <div class="relative">
            <button id="faq-button" class="bg-blue-800 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
              <span class="mr-1">❓</span>FAQ
            </button>
            <div id="faq-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white text-gray-800 rounded-lg shadow-lg border z-50">
              <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="font-semibold text-lg">FAQ</h3>
                  <button id="faq-close" class="text-gray-400 hover:text-gray-600 text-2xl w-8 h-8 flex items-center justify-center">&times;</button>
                </div>
                
                <div class="space-y-4 max-h-[60vh] overflow-y-auto">
                  <div>
                    <h4 class="font-medium text-blue-900 mb-2 text-sm">What is VetDesk?</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">VetDesk™ is a free service made by veterans for veterans. Our mission is to help explain VA benefits and the policies that affect them in plain English and in a secure, simple, and respectful way. Just ask questions and get clear answers.</p>
                  </div>
                  
                  <div>
                    <h4 class="font-medium text-blue-900 mb-2 text-sm">Important</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">VetDesk™ is independent and not affiliated with the VA. For the latest information or to apply for benefits, visit VA.gov or call 1-800-827-1000.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden">
    <div class="bg-white w-full max-w-sm ml-auto h-full shadow-lg flex flex-col">
      <div class="p-4 border-b border-gray-200 flex-shrink-0">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold text-gray-900">Menu</h3>
          <button id="mobile-menu-close" class="text-gray-400 hover:text-gray-600 text-2xl w-8 h-8 flex items-center justify-center">
            &times;
          </button>
        </div>
      </div>
      
      <div class="flex-1 overflow-y-auto p-4 space-y-4">
        <!-- About Section -->
        <div class="border-b border-gray-200 pb-4">
          <h4 class="font-medium text-blue-900 mb-3">About VetDesk</h4>
          <p class="text-sm text-gray-600 leading-relaxed mb-3">VetDesk™ is a free service made by veterans for veterans. Our mission is to help explain VA benefits and the policies that affect them in plain English and in a secure, simple, and respectful way. Just ask questions and get clear answers.</p>
          <p class="text-sm text-gray-600 leading-relaxed"><strong>Important:</strong> VetDesk™ is independent and not affiliated with the VA. For the latest information or to apply for benefits, visit VA.gov or call 1-800-827-1000.</p>
        </div>
        
        <!-- FAQ Section -->
        <div>
          <h4 class="font-medium text-blue-900 mb-3">Frequently Asked Questions</h4>
          <div class="space-y-4">
            <div>
              <h5 class="font-medium text-gray-900 text-sm mb-1">How many questions can I ask?</h5>
              <p class="text-sm text-gray-600 leading-relaxed">You can ask up to 12 questions per conversation. This limit helps us keep VetDesk completely free for all veterans. After 12 questions, simply refresh the page to start a new conversation.</p>
            </div>
            
            <div>
              <h5 class="font-medium text-gray-900 text-sm mb-1">Is this an official VA website?</h5>
              <p class="text-sm text-gray-600 leading-relaxed">No, VetDesk is not an official VA website. We're an independent service that helps veterans understand VA benefits in plain English. For official VA business, always visit VA.gov or call 1-800-827-1000.</p>
            </div>
            
            <div>
              <h5 class="font-medium text-gray-900 text-sm mb-1">Is my information private?</h5>
              <p class="text-sm text-gray-600 leading-relaxed">Yes. We don't store your personal information or conversation history. Each conversation is temporary and deleted when you close the page. If you request an email summary, we only use your email to send it and don't store it.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <main class="flex-1 flex flex-col md:flex-row overflow-hidden">

    <!-- News Feed -->
    <section id="news-feed-section" class="w-full md:w-80 bg-white border-r border-gray-200 overflow-y-auto p-4 flex flex-col min-w-[0]">
      <h2 class="text-xl font-semibold mb-3">Veteran News Feed</h2>
      <ul id="news-feed" class="space-y-4 flex-1"></ul>
      
      <!-- COPYRIGHT FOOTER -->
      <div class="mt-auto pt-4 border-t border-gray-200 text-xs text-gray-500 text-center">
        © 2025 VetDesk™. All rights reserved.
      </div>
    </section>

    <!-- Chat Section -->
    <section id="chat-section" class="flex-1 flex flex-col h-full bg-gray-50">
      <div id="welcome-message" class="p-4 text-base text-gray-700 bg-white border-b border-gray-200">
        <span>
          👋 Hi there, and welcome! I'm here to help you understand your VA benefits in plain everyday English. Just ask me any questions you have.
        </span>
      </div>
      
      <!-- Quick Actions -->
      <div id="quick-actions" class="flex bg-white border-b border-gray-200"></div>
      
      <div id="chat-container" class="flex-1 flex flex-col min-h-0 relative">
        <div id="chat-history" class="flex-1 overflow-y-auto p-4" aria-live="polite"></div>
        
        <!-- NEW: Scroll to bottom button -->
        <button id="scroll-to-bottom" class="scroll-to-bottom" aria-label="Scroll to bottom">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
        </button>
        
        <!-- NEW: Updated form with character counter and textarea -->
        <form id="chat-form" class="bg-white border-t border-gray-200" autocomplete="off">
          <div class="input-container p-4">
            <!-- NEW: Character counter -->
            <div class="flex justify-between items-center mb-2">
              <div class="flex-1"></div>
              <div id="char-counter" class="char-counter">
                <span id="char-count">0</span>/<span id="char-limit">2000</span>
              </div>
            </div>
            
            <!-- NEW: Textarea instead of input -->
            <div class="flex gap-2 relative">
              <textarea 
                id="chat-input" 
                class="chat-textarea flex-1 border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                placeholder="Ask me anything..." 
                autocomplete="off" 
                required 
                aria-label="Chat input" 
                maxlength="2000"
                rows="1"></textarea>
              <button 
                type="submit" 
                id="send-button" 
                class="bg-blue-700 text-white px-6 py-3 rounded-lg hover:bg-blue-800 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0"
                disabled>
                <span id="send-button-text">Send</span>
                <!-- NEW: Loading spinner for send button -->
                <div id="send-button-spinner" class="hidden">
                  <div class="spinner" style="width: 16px; height: 16px; border-width: 2px;"></div>
                </div>
              </button>
            </div>
            
            <!-- NEW: Loading overlay for input -->
            <div id="input-loading-overlay" class="input-loading-overlay hidden">
              <div class="typing-indicator">
                <span class="text-gray-600">VetDesk is typing</span>
                <div class="typing-dots">
                  <div class="typing-dot"></div>
                  <div class="typing-dot"></div>
                  <div class="typing-dot"></div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </section>
  </main>

  <!-- Load JavaScript files -->
  <script src="js/config.js"></script>
  <script src="js/email.js"></script>
  <script src="js/news.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/main.js"></script>

</body>
</html>
