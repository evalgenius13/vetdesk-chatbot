<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VetDesk Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' https://vetdesk-demo2-api.vercel.app; font-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media (max-width: 768px) {
      #news-feed-section {
        display: none;
      }
      #chat-section {
        flex: 1 1 100%;
      }
    }
    @media (min-width: 768px) {
      .mobile-news-inline {
        display: none !important;
      }
    }
    .chat-bubble-user {
      max-width: 42rem;
      background: #1e40af;
      color: white;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      line-height: 1.6;
      white-space: pre-line;
      margin-left: auto;
      word-break: break-word;
    }
    .chat-bubble-bot {
      max-width: 42rem;
      background: #f9fafb;
      color: #1f2937;
      border-radius: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
      line-height: 1.6;
      white-space: pre-line;
      word-break: break-word;
      border: 1px solid #e5e7eb;
    }
    .chat-bubble-bot p {
      margin-bottom: 1rem;
    }
    .chat-bubble-bot p:last-child {
      margin-bottom: 0;
    }
    .spinner {
      border: 3px solid #e5e7eb;
      border-top: 3px solid #1e40af;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    #chat-history {
      scroll-behavior: smooth;
    }
    .message-container {
      margin-bottom: 1.5rem;
    }
    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }
    .news-loading {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      text-align: center;
      color: #6b7280;
    }
    .news-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
    }
    .news-item {
      transition: all 0.2s ease;
    }
    .news-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .hamburger {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    .hamburger-line {
      width: 18px;
      height: 2px;
      background: white;
      margin: 2px 0;
      transition: 0.3s;
    }
    /* Mobile news inline styles */
    .mobile-news-inline {
      display: none;
      flex: 1 1 auto;
      background: white;
      border-top: 1px solid #e5e7eb;
      border-bottom: 1px solid #e5e7eb;
      max-height: 100%;
      overflow-y: auto;
    }
    .mobile-news-inline.show {
      display: block;
    }
  </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">

  <header class="bg-blue-900 text-white p-3 sm:p-4">
    <!-- ... header unchanged ... -->
    <!-- (keep your header here, omitted for brevity) -->
    <!-- ... header unchanged ... -->
  </header>

  <main class="flex-1 flex flex-col md:flex-row overflow-hidden">

    <!-- News Feed (desktop only) -->
    <section id="news-feed-section" class="w-full md:w-80 bg-white border-r border-gray-200 overflow-y-auto p-4 flex flex-col min-w-[0]">
      <h2 class="text-xl font-semibold mb-3">Veteran News Feed</h2>
      <ul id="news-feed" class="space-y-4 flex-1"></ul>
      <div class="mt-auto pt-4 border-t border-gray-200 text-xs text-gray-500 text-center">
        Â© 2025 VetDeskâ„¢. All rights reserved.
      </div>
    </section>

    <!-- Chat Section -->
    <section id="chat-section" class="flex-1 flex flex-col h-full bg-gray-50">
      <div id="welcome-message" class="p-4 text-base text-gray-700 bg-white border-b border-gray-200">
        <span>
          ðŸ‘‹ Hi there, and welcome! I'm here to help you understand your VA benefits in plain everyday English. Just ask me any questions you have.
        </span>
        <div id="question-counter" class="text-xs text-gray-500 mt-2">
          Questions remaining: <span id="questions-left">12</span>/12
        </div>
      </div>
      <div id="quick-actions" class="flex flex-wrap gap-2 p-4 bg-white border-b border-gray-200"></div>

      <!-- Mobile News Inline Section (mobile only, hidden by default) -->
      <div id="mobile-news-inline" class="mobile-news-inline">
        <div class="p-4">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-semibold text-lg">Veteran News Feed</h3>
            <button id="mobile-news-close" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
          </div>
          <ul id="mobile-news-feed" class="space-y-4"></ul>
        </div>
      </div>

      <!-- New Chat Container wrapper -->
      <div id="chat-container" class="flex-1 flex flex-col">
        <div id="chat-history" class="flex-1 overflow-y-auto p-4" aria-live="polite"></div>
        <form id="chat-form" class="flex gap-2 p-4 bg-white border-t border-gray-200" autocomplete="off">
          <input id="chat-input" type="text" class="flex-1 border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ask me anything..." autocomplete="off" required aria-label="Chat input" maxlength="2000" />
          <button type="submit" id="send-button" class="bg-blue-700 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">Send</button>
        </form>
      </div>
    </section>
  </main>

  <!-- Load JavaScript files -->
  <script src="js/config.js"></script>
  <script src="js/email.js"></script>
  <script src="js/news.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/main.js"></script>

  <!-- Navigation JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Set responsive placeholder text
      const chatInput = document.getElementById('chat-input');
      const updatePlaceholder = () => {
        if (window.innerWidth >= 640) { // sm breakpoint
          chatInput.placeholder = 'Ask me anything about VA benefits...';
        } else {
          chatInput.placeholder = 'Ask me anything...';
        }
      };
      updatePlaceholder();
      window.addEventListener('resize', () => {
        updatePlaceholder();
        // Auto-close mobile news inline if window is resized to desktop
        if (window.innerWidth >= 768) {
          document.getElementById('mobile-news-inline').classList.remove('show');
          document.getElementById('chat-container').style.display = 'flex';
        }
      });

      // Mobile News Inline functionality
      const mobileNewsInline = document.getElementById('mobile-news-inline');
      const mobileNewsClose = document.getElementById('mobile-news-close');
      const mobileNewsFeed = document.getElementById('mobile-news-feed');
      const chatContainer = document.getElementById('chat-container');
      const desktopNews = document.getElementById('news-feed');

      window.openMobileNews = function() {
        mobileNewsInline.classList.add('show');
        chatContainer.style.display = 'none';
        // Copy news feed content to mobile inline
        if (desktopNews && mobileNewsFeed) {
          mobileNewsFeed.innerHTML = desktopNews.innerHTML;
          attachMobileNewsEventListeners();
        }
      };
      window.closeMobileNews = function() {
        mobileNewsInline.classList.remove('show');
        chatContainer.style.display = 'flex';
      };
      if (mobileNewsClose) {
        mobileNewsClose.addEventListener('click', closeMobileNews);
      }
      function attachMobileNewsEventListeners() {
        const mobileNewsItems = mobileNewsFeed.querySelectorAll('.news-item button');
        mobileNewsItems.forEach(button => {
          button.addEventListener('click', function() {
            const newsText = this.getAttribute('data-news-text');
            if (newsText) {
              closeMobileNews();
              if (typeof addUserMessageToChat === 'function') {
                addUserMessageToChat(newsText);
              }
            }
          });
        });
      }

      // Desktop FAQ Dropdown (unchanged)
      // ...rest of your navigation JS unchanged...
    });
  </script>
</body>
</html>
