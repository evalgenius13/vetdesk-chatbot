<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VetDesk Chat</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' https://vetdesk-demo2-api.vercel.app; font-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media (max-width: 768px) {
      #news-feed-section {
        display: none;
      }
      #chat-section {
        flex: 1 1 100%;
      }
    }
    .chat-bubble-user {
      max-width: 42rem;
      background: #1e40af;
      color: white;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      line-height: 1.6;
      white-space: pre-line;
      margin-left: auto;
      word-break: break-word;
    }
    .chat-bubble-bot {
      max-width: 42rem;
      background: #f9fafb;
      color: #1f2937;
      border-radius: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 1.5rem;
      line-height: 1.6;
      white-space: pre-line;
      word-break: break-word;
      border: 1px solid #e5e7eb;
    }
    .chat-bubble-bot p {
      margin-bottom: 1rem;
    }
    .chat-bubble-bot p:last-child {
      margin-bottom: 0;
    }
    .spinner {
      border: 3px solid #e5e7eb;
      border-top: 3px solid #1e40af;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    #chat-history {
      scroll-behavior: smooth;
    }
    .message-container {
      margin-bottom: 1.5rem;
    }
    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }
    .news-loading {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      text-align: center;
      color: #6b7280;
    }
    .news-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
    }
    .news-item {
      transition: all 0.2s ease;
    }
    .news-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">

  <header class="bg-blue-900 text-white p-4 flex items-center justify-between">
    <div class="flex items-center">
      <img src="/logo.png" alt="VetDesk Logo" class="w-8 h-8 mr-2">
      <h1 class="text-2xl font-bold mr-2 mb-0 inline-block">VetDesk</h1>
      <span class="text-xs font-light text-blue-200 align-baseline">‚Ñ¢ VA Benefits, Simplified.</span>
    </div>
    
    <div class="flex items-center space-x-3">
      <!-- About Dropdown -->
      <div class="relative">
        <button id="about-button" class="bg-blue-800 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
          <span class="mr-1">‚ÑπÔ∏è</span>About
        </button>
        <div id="about-dropdown" class="hidden absolute right-0 mt-2 w-72 sm:w-80 bg-white text-gray-800 rounded-lg shadow-lg border z-50 max-w-[calc(100vw-2rem)] mr-4 sm:mr-0">
          <div class="p-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="font-semibold text-base sm:text-lg">About VetDesk</h3>
              <button id="about-close" class="text-gray-400 hover:text-gray-600 text-2xl w-8 h-8 flex items-center justify-center">&times;</button>
            </div>
            
            <div class="space-y-4 max-h-[60vh] overflow-y-auto">
              <div>
                <h4 class="font-medium text-blue-900 mb-2 text-sm">What is VetDesk?</h4>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">VetDesk is a free service made by veterans for veterans. Our mission is to help explain VA benefits and the policies that affect them in plain English and in a secure, simple, and respectful way. Just ask questions and get clear answers.</p>
              </div>
              
              <div>
                <h4 class="font-medium text-blue-900 mb-2 text-sm">Important</h4>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">VetDesk is independent and not affiliated with the VA. For the latest information or to apply for benefits, visit VA.gov or call 1-800-827-1000.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- FAQ Dropdown -->
      <div class="relative">
        <button id="faq-button" class="bg-blue-800 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
          <span class="mr-1">‚ùì</span>FAQ
        </button>
        <div id="faq-dropdown" class="hidden absolute right-0 mt-2 w-72 sm:w-80 bg-white text-gray-800 rounded-lg shadow-lg border z-50 max-w-[calc(100vw-2rem)] mr-4 sm:mr-0">
          <div class="p-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="font-semibold text-base sm:text-lg">FAQ</h3>
              <button id="faq-close" class="text-gray-400 hover:text-gray-600 text-2xl w-8 h-8 flex items-center justify-center">&times;</button>
            </div>
            
            <div class="space-y-4 max-h-[60vh] overflow-y-auto">
              <div>
                <h4 class="font-medium text-blue-900 mb-2 text-sm">How many questions can I ask?</h4>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">You can ask up to 12 questions per conversation. This limit helps us keep VetDesk completely free for all veterans. After 12 questions, simply refresh the page to start a new conversation.</p>
              </div>
              
              <div>
                <h4 class="font-medium text-blue-900 mb-2 text-sm">Is this an official VA website?</h4>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">No, VetDesk is not an official VA website. We're an independent service that helps veterans understand VA benefits in plain English. For official VA business, always visit VA.gov or call 1-800-827-1000.</p>
              </div>
              
              <div>
                <h4 class="font-medium text-blue-900 mb-2 text-sm">Is my information private?</h4>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">Yes. We don't store your personal information or conversation history. Each conversation is temporary and deleted when you close the page. If you request an email summary, we only use your email to send it and don't store it.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="flex-1 flex flex-col md:flex-row overflow-hidden">

    <!-- News Feed -->
    <section id="news-feed-section" class="w-full md:w-80 bg-white border-r border-gray-200 overflow-y-auto p-4 flex flex-col min-w-[0]">
      <h2 class="text-xl font-semibold mb-3">Veteran News Feed</h2>
      <ul id="news-feed" class="space-y-4 flex-1"></ul>
    </section>

    <!-- Chat Section -->
    <section id="chat-section" class="flex-1 flex flex-col h-full bg-gray-50">
      <div id="welcome-message" class="p-4 text-base text-gray-700 bg-white border-b border-gray-200">
        <span>
          üëã Hi there, and welcome! I'm here to help you understand your VA benefits in plain everyday English. Just ask me any questions you have.
        </span>
        <div id="question-counter" class="text-xs text-gray-500 mt-2">
          Questions remaining: <span id="questions-left">12</span>/12
        </div>
      </div>
      
      <div id="quick-actions" class="flex flex-wrap gap-2 p-4 bg-white border-b border-gray-200"></div>
      <div id="chat-history" class="flex-1 overflow-y-auto p-4" aria-live="polite"></div>
      <form id="chat-form" class="flex gap-2 p-4 bg-white border-t border-gray-200" autocomplete="off">
        <input id="chat-input" type="text" class="flex-1 border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ask me anything about VA benefits..." autocomplete="off" required aria-label="Chat input" maxlength="2000" />
        <button type="submit" id="send-button" class="bg-blue-700 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">Send</button>
      </form>
    </section>
  </main>

  <!-- Load JavaScript files -->
  <script src="js/config.js"></script>
  <script src="js/email.js"></script>
  <script src="js/news.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/main.js"></script>

  <!-- FAQ and About Dropdown JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // FAQ Dropdown
      const faqButton = document.getElementById('faq-button');
      const faqDropdown = document.getElementById('faq-dropdown');
      const faqClose = document.getElementById('faq-close');

      // About Dropdown
      const aboutButton = document.getElementById('about-button');
      const aboutDropdown = document.getElementById('about-dropdown');
      const aboutClose = document.getElementById('about-close');

      // Toggle FAQ dropdown
      faqButton.addEventListener('click', (e) => {
        e.stopPropagation();
        faqDropdown.classList.toggle('hidden');
        aboutDropdown.classList.add('hidden'); // Close About if open
      });

      // Toggle About dropdown
      aboutButton.addEventListener('click', (e) => {
        e.stopPropagation();
        aboutDropdown.classList.toggle('hidden');
        faqDropdown.classList.add('hidden'); // Close FAQ if open
      });

      // Close FAQ dropdown
      faqClose.addEventListener('click', () => {
        faqDropdown.classList.add('hidden');
      });

      // Close About dropdown
      aboutClose.addEventListener('click', () => {
        aboutDropdown.classList.add('hidden');
      });

      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!faqButton.contains(e.target) && !faqDropdown.contains(e.target)) {
          faqDropdown.classList.add('hidden');
        }
        if (!aboutButton.contains(e.target) && !aboutDropdown.contains(e.target)) {
          aboutDropdown.classList.add('hidden');
        }
      });
    });
  </script>

</body>
</html>
