<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VetDesk - Get the Facts Fast</title>

  <!-- React + Babel + Tailwind for development -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, sans-serif;
      background-color: #f9fafb;
    }
  </style>
</head>
<body>
  <!-- Landing Section -->
  <section class="landing-section text-center py-20 px-4 bg-gradient-to-br from-slate-100 to-slate-200">
    <div class="text-sm font-bold text-slate-600 tracking-wider uppercase mb-6">VETDESK™</div>
    <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-900 mb-4">Get the Facts Fast.</h1>
    <p class="text-lg text-slate-700 max-w-2xl mx-auto mb-4">
      Every veteran has questions. Few get answers that make sense. VetDesk breaks down policies, benefits, and news in real time—so you see what's happening, what's changing, and what it means for you.
    </p>
    <p class="text-base text-slate-500 max-w-xl mx-auto mb-8 italic">
      It's not just information. It's context. It's clarity. It's control. Built for veterans who need answers - now.
    </p>
    <button onclick="scrollToChatbot()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-md shadow-md transition">
      Try Demo – It's Free
    </button>
  </section>

  <!-- Chatbot + News Section -->
  <section class="chatbot-section">
    <div class="flex flex-col md:flex-row h-[calc(100vh-160px)]">
      <div class="chat-column flex-1 bg-slate-50 border-r border-slate-200">
        <div id="chatbot-root" class="h-full"></div>
      </div>
      <div class="news-column w-full md:w-[400px] bg-white border-t md:border-t-0 md:border-l border-slate-200">
        <div class="p-4 border-b border-slate-200">
          <h3 class="text-lg font-bold text-slate-800">Recent Veterans News</h3>
        </div>
        <div id="news-container" class="p-4 overflow-y-auto h-full">
          <div class="text-slate-400 text-center">Loading news...</div>
        </div>
      </div>
    </div>
  </section>

  <script>
    function scrollToChatbot() {
      document.querySelector('.chatbot-section').scrollIntoView({ behavior: 'smooth' });
    }
  </script>

  <!-- React App -->
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function ChatbotApp() {
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const textareaRef = useRef(null);
      const messagesEndRef = useRef(null);

      const MAX_MESSAGE_LENGTH = 2000;

      const handleSend = () => {
        if (!input.trim()) return;
        setMessages(prev => [...prev, { text: input, sender: 'user' }]);
        setInput('');
        setIsLoading(true);

        // Simulate bot response
        setTimeout(() => {
          setMessages(prev => [...prev, { text: "Thanks for your question. We're looking into it!", sender: 'bot' }]);
          setIsLoading(false);
        }, 1000);
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSend();
        }
      };

      useEffect(() => {
        if (messagesEndRef.current) {
          messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
        }
      }, [messages]);

      return (
        <div className="flex flex-col h-full">
          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {messages.map((msg, idx) => (
              <div key={idx} className={`max-w-xl ${msg.sender === 'user' ? 'ml-auto text-right' : 'text-left'}`}>
                <div className={`p-3 rounded-lg ${msg.sender === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'}`}>
                  {msg.text}
                </div>
              </div>
            ))}
            {isLoading && (
              <div className="text-sm text-gray-500">Typing...</div>
            )}
            <div ref={messagesEndRef}></div>
          </div>
          <div className="border-t p-4 bg-white flex gap-2">
            <textarea
              ref={textareaRef}
              className="flex-1 p-2 border border-gray-300 rounded-md resize-none"
              rows="2"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={handleKeyPress}
              placeholder="Ask a question about your VA benefits..."
            />
            <button
              onClick={handleSend}
              disabled={!input.trim()}
              className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-semibold"
            >
              Send
            </button>
          </div>
        </div>
      );
    }

    function NewsApp() {
      const [newsArticles, setNewsArticles] = useState([]);
      const [isLoading, setIsLoading] = useState(true);

      useEffect(() => {
        fetch('https://vetdesk-demo2-api.vercel.app/api/va-news')
          .then(res => res.json())
          .then(data => {
            setNewsArticles(data.sources || []);
            setIsLoading(false);
          })
          .catch(() => {
            setIsLoading(false);
          });
      }, []);

      const handleNewsQuestion = (article) => {
        const inputBox = document.querySelector('textarea');
        if (inputBox) {
          inputBox.value = `How does this affect me? (${article.title})`;
          inputBox.focus();
          inputBox.dispatchEvent(new Event('input', { bubbles: true }));
        }

        const chatbox = document.querySelector('#chatbot-root');
        if (chatbox) {
          chatbox.scrollIntoView({ behavior: 'smooth' });
        }
      };

      if (isLoading) {
        return <div className="text-center text-slate-400">Loading news...</div>;
      }

      if (!newsArticles.length) {
        return <div className="text-center text-slate-400">No news available</div>;
      }

      return (
        <div className="space-y-4">
          {newsArticles.map((article, index) => (
            <div key={index} className="news-article border rounded-lg bg-gray-50 overflow-hidden">
              {article.image && (
                <img src={article.image} alt={article.title} className="w-full h-40 object-cover" />
              )}
              <div className="p-4">
                <h4 className="font-semibold text-slate-900 mb-1">{article.title}</h4>
                <span className="text-sm text-slate-500">{new Date(article.pubDate).toLocaleDateString()} – {article.source}</span>
                <button
                  onClick={() => handleNewsQuestion(article)}
                  className="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 rounded-md"
                >
                  How does this affect me?
                </button>
              </div>
            </div>
          ))}
        </div>
      );
    }

    const chatRoot = document.getElementById('chatbot-root');
    if (chatRoot) {
      try {
        ReactDOM.createRoot(chatRoot).render(<ChatbotApp />);
      } catch (error) {
        console.error('Failed to render chatbot:', error);
        chatRoot.innerHTML = '<div class="text-center text-red-500 p-4">Chatbot temporarily unavailable.</div>';
      }
    }

    const newsRoot = document.getElementById('news-container');
    if (newsRoot) {
      try {
        ReactDOM.createRoot(newsRoot).render(<NewsApp />);
      } catch (error) {
        console.error('Failed to render news:', error);
        newsRoot.innerHTML = '<div class="text-center text-red-500 p-4">News temporarily unavailable.</div>';
      }
    }
  </script>
</body>
</html>
